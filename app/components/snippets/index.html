<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8" />
	<title>Home</title>
	<link rel="stylesheet" href="app/assets/build/styles/styles.css" />
	<link rel="stylesheet" href="app/assets/css/main.css" />
</head>

<body>
	<div class="main-body">
		<h1>Employee List</h1>
	<div class="c-user-form">
		<h3>Add New User</h3>
		<form method="POST" id="addSnippetform">
			<div class="form-group">
				<label for="exampleInputEmail1">User Name</label>
				<input type="text" name="userName" class="form-control" id="userName" placeholder="User Name" required/>
			</div>
			<div class="form-group">
				<label for="userEmail">Email</label>
				<input type="email" name="userEmail" class="form-control" id="userEmail" placeholder="Email Address" required/>
			</div>
			<div class="form-group">
				<label for="userPhone">Contact Number</label>
				<input type="tel" name="userPhone" class="form-control" id="userPhone" placeholder="Password" required/>
			</div>
			<button type="submit" class="btn btn-default" id="submit">Submit</button>
		</form>
	</div>
	<div id="sample-data">

	</div>
	</div>

	<script src="app/assets/build/scripts/script.js"></script>

	<script>
		var UsersModule = (function($) {
				// PRIVATE METHODS
				//=======================================
				function _bindTemplate(templateID, data, containerID) {
					var source = $(templateID).html();
					var template = Handlebars.compile(source);
					var html = template(data);
					$(containerID).html(html);
				};

				// PUBLIC METHODS
				//=======================================
				// Get all the users from database on page load
				function getAllUsers() {
					
					fetch('/snippets/all') // Call the fetch function passing the url of the API as a parameter
						.then(function(resp) {
							return resp.json()
					}) // Transform the data into json
					.then(function(data) {
						// Your code for handling the data you get from the API
						_bindTemplate("#entry-template", data, '#sample-data');
					})
					.catch(function() {
						// This is where you run code if the server returns any errors
					});
				};

				// Create New User
				function createUser() {
					// process the form to save data into database
					//$('#addSnippetform').submit(function(event) {
						

						// get the form data
						// there are many ways to get this data using jQuery (you can use the class or id also)
						var formData = {
							'name': $('input[name=userName]').val(),
							'email': $('input[name=userEmail]').val(),
							'phone': $('input[name=userPhone]').val(),
							'dateCreated': new Date().getTime()
						};

						// process the form
						$.ajax({
								type: 'POST', // define the type of HTTP verb we want to use (POST for our form)
								url: '/snippets/addSnippet', // the url where we want to POST
								data: formData, // our data object
								dataType: 'json', // what type of data do we expect back from the server
								encode: true
						})
						// using the done promise callback
						.done(function(data) {
							_bindTemplate("#entry-template", data.snippet, '#sample-data');
							/*var source = $("#entry-template").html();
							var template = Handlebars.compile(source);
							var html = template(data.snippet);
							$('#sample-data').append(html);*/
						});
					//});					
				};
				
				function removeUser(id) {
					// url (required), options (optional)
					fetch('/snippets/deleteSnippet/'+id, {
						method: 'DELETE'
					}).then(function(response) {
						console.log("User Deleted with ID :", id, response);
						getAllUsers();
					}).catch(function(err) {
						// Error :(
						console.log("Error :", err);
					});
				};

				return {
					getAllUsers : getAllUsers,
					createUser: createUser,
					removeUser: removeUser
				}

			})(jQuery);


		$(document).ready(function() {
			UsersModule.getAllUsers();

			$('#sample-data').on('click', '.delete-user', function(){
				var id= $(this).data('user-id');
				UsersModule.removeUser(id);
				UsersModule.getAllUsers();
			});

			$('#addSnippetform').submit(function(event) {
				// stop the form from submitting the normal way and refreshing the page
				event.preventDefault();
				UsersModule.createUser();
				UsersModule.getAllUsers();
			});
		});
	</script>

<!-- START : TEMPLATES -->
<script id="entry-template" type="text/x-handlebars-template">
	<ul class="c-user-list">
		{{#each snippets}}
			<li>
				<h3>User Name : {{name}}</h3>
				<div class="body">
				<strong>Email : </strong>{{email}}
				<strong>Phone : </strong>{{phone}}
				<a href="javascript:;" class="view-detail" data-user-id="{{_id}}">View Detail</a>
				<a href="javascript:;" class="delete-user" data-user-id="{{_id}}">Delete</a>
				</div>
			</li>
		{{/each}}
	</ul>
</script>
<!-- END : TEMPLATES -->

</body>

</html>
